(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var handleIndexedDB=function handleIndexedDB(){var _dbResult;var _key;var _storeName;function init(dbConfig,callback){if(!window.indexedDB){window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");return 0}if(callback){_openDB(dbConfig,callback)}return 0}function _openDB(dbConfig,callback){var request=indexedDB.open(dbConfig.name,dbConfig.version);_storeName=dbConfig.storeName;request.onerror=function error(){console.log("Pity, fail to load indexedDB")};request.onsuccess=function success(e){_dbResult=e.target.result;getPresentKey(callback)};request.onupgradeneeded=function schemaChanged(e){_dbResult=e.target.result;if(!_dbResult.objectStoreNames.contains(_storeName)){var store=_dbResult.createObjectStore(_storeName,{keyPath:dbConfig.key,autoIncrement:true})}store.add(dbConfig.dataDemo)}}function _handleTransaction(whetherWrite){var transaction;if(whetherWrite){transaction=_dbResult.transaction([_storeName],"readwrite")}else{transaction=_dbResult.transaction([_storeName])}return transaction.objectStore(_storeName)}function _rangeToAll(){return IDBKeyRange.lowerBound(0,true)}function getPresentKey(callback){var storeHander=_handleTransaction(true);var range=IDBKeyRange.lowerBound(0);storeHander.openCursor(range,"next").onsuccess=function getTheKey(e){var cursor=e.target.result;if(cursor){cursor.continue();_key=cursor.value.id}else{console.log("now key is:"+_key);callback()}}}function add(newData,callback,callbackParaArr){var storeHander=_handleTransaction(true);var addOpt=storeHander.add(newData);addOpt.onerror=function error(){console.log("Pity, failed to add one data to indexedDB")};addOpt.onsuccess=function success(){console.log("Bravo, success to add one data to indexedDB");if(callback){if(!callbackParaArr){callback()}else{callback.apply(null,callbackParaArr)}}}}function get(key,callback,callbackParaArr){var storeHander=_handleTransaction(false);var getDataKey=storeHander.get(key);getDataKey.onerror=function getDataKeyError(){console.log("Pity, get (key:"+key+"'s) data"+" faild")};getDataKey.onsuccess=function getDataKeySuccess(){console.log("Great, get (key:"+key+"'s) data succeed");if(!callbackParaArr){callback(getDataKey.result)}else{callbackParaArr.unshift(getDataKey.result);callback.apply(null,callbackParaArr)}}}function getWhether(whether,condition,callback,callbackParaArr){var dataArr=[];var storeHander=_handleTransaction(true);var range=_rangeToAll();storeHander.openCursor(range,"next").onsuccess=function showWhetherDoneData(e){var cursor=e.target.result;if(cursor){if(whether){if(cursor.value[condition]){dataArr.push(cursor.value)}}else if(!whether){if(!cursor.value[condition]){dataArr.push(cursor.value)}}cursor.continue()}else if(callback){if(!callbackParaArr){callback(dataArr)}else{callbackParaArr.unshift(dataArr);callback.apply(null,callbackParaArr)}}}}function getAll(callback,callbackParaArr){var storeHander=_handleTransaction(true);var range=_rangeToAll();var allDataArr=[];storeHander.openCursor(range,"next").onsuccess=function getAllData(e){var cursor=e.target.result;if(cursor){allDataArr.push(cursor.value);cursor.continue()}else if(callback){if(!callbackParaArr){callback(allDataArr)}else{callbackParaArr.unshift(allDataArr);callback.apply(null,callbackParaArr)}}}}function update(changedData,callback,callbackParaArr){var storeHander=_handleTransaction(true);var putStore=storeHander.put(changedData);putStore.onerror=function putStoreError(){console.log("Pity, modify failed")};putStore.onsuccess=function putStoreSuccess(){console.log("Aha, modify succeed");if(callback){if(!callbackParaArr){callback()}else{callback.apply(null,callbackParaArr)}}}}function deleteOne(key,callback,callbackParaArr){var storeHander=_handleTransaction(true);var deleteOpt=storeHander.delete(key);deleteOpt.onerror=function error(){console.log("delete (key:"+key+"'s) value faild")};deleteOpt.onsuccess=function success(){console.log("delete (key: "+key+"'s) value succeed");if(callback){if(!callbackParaArr){callback()}else{callback.apply(callbackParaArr)}}}}function deleteAll(callback,callbackParaArr){var storeHander=_handleTransaction(true);var range=_rangeToAll();storeHander.openCursor(range,"next").onsuccess=function deleteData(e){var cursor=e.target.result;var requestDel;if(cursor){requestDel=cursor.delete();requestDel.onsuccess=function success(){console.log("Great, delete all data succeed")};requestDel.onerror=function error(){console.log("Pity, delete all data faild")};cursor.continue()}else if(callback){if(!callbackParaArr){callback()}else{callback.apply(null,this)}}}}function getKey(){_key++;return _key}return{init:init,getKey:getKey,add:add,get:get,getWhether:getWhether,getAll:getAll,update:update,delete:deleteOne,deleteAll:deleteAll}}();module.exports=handleIndexedDB},{}],2:[function(require,module,exports){"use strict";(function goToDo(){var DB=require("indexeddb-crud");var dbConfig={name:"justToDo",version:"6",key:"id",storeName:"user"};dbConfig.dataDemo={id:0,event:0,finished:true,date:0};DB.init(dbConfig,addEventListeners);function addEventListeners(){var myUl=document.querySelector("#myUl");showData();myUl.addEventListener("click",handleLiClickDelegation,false);myUl.addEventListener("click",handleXClickDelagation,false);document.getElementById("add").addEventListener("click",addOneList,false);document.addEventListener("keydown",handleEnterEvent,true);document.getElementById("done").addEventListener("click",showDataDone,false);document.getElementById("todo").addEventListener("click",showDataTodo,false);document.getElementById("all").addEventListener("click",showData,false);document.getElementById("delete").addEventListener("click",deleteAllData,false)}function resetNodes(){var root=document.querySelector("#myUl");while(root.hasChildNodes()){root.removeChild(root.firstChild)}}function showData(){resetNodes();DB.getAll(refreshNodes)}function refreshNodes(dataArr){var fragment=document.createDocumentFragment();var i;var len=dataArr.length;for(i=0;i<len;i++){fragment.insertBefore(refreshOneNode(dataArr[i]),fragment.firstChild)}document.querySelector("#myUl").appendChild(fragment);console.log("刷新，并展示数据完毕")}function refreshOneNode(data){var textDate=document.createTextNode(data.userDate+": ");var textWrap=document.createElement("span");var text=document.createTextNode(" "+data.event);var li=document.createElement("li");var span;var x;textWrap.appendChild(text);li.appendChild(textDate);li.appendChild(textWrap);if(data.finished){li.classList.add("checked")}span=document.createElement("span");x=document.createTextNode("×");span.className="close";span.appendChild(x);span.setAttribute("data-x",data.id);li.appendChild(span);if(!li.getAttribute("data-id")){li.setAttribute("data-id",data.id)}return li}function addOneList(){var input=document.querySelector("#myInput");var value=input.value;var date=getNewDate("yyyy年MM月dd日 hh:mm");var newNodeData;var newNode;var parent=document.querySelector("#myUl");if(value===""){alert("请亲传入数据后重新提交~");return false}newNodeData={id:DB.getKey(),event:value,finished:false,userDate:date};newNode=refreshOneNode(newNodeData);newNode.setAttribute("data-id",newNodeData.id);parent.insertBefore(newNode,parent.firstChild);input.value="";DB.add(newNodeData);return 0}function getNewDate(fmt){var newDate=new Date;var newfmt=fmt;var o={"y+":newDate.getFullYear(),"M+":newDate.getMonth()+1,"d+":newDate.getDate(),"h+":newDate.getHours(),"m+":newDate.getMinutes()};for(var k in o){if(new RegExp("("+k+")").test(newfmt)){if(k==="y+"){newfmt=newfmt.replace(RegExp.$1,(""+o[k]).substr(4-RegExp.$1.length))}else if(k==="S+"){var lens=RegExp.$1.length;lens=lens===1?3:lens;newfmt=newfmt.replace(RegExp.$1,("00"+o[k]).substr((""+o[k]).length-1,lens))}else{newfmt=newfmt.replace(RegExp.$1,RegExp.$1.length===1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}}return newfmt}function handleEnterEvent(e){if(e.keyCode===13){addOneList()}}function handleLiClickDelegation(e){var thisLi=e.target;var dataId;if(thisLi.getAttribute("data-id")){dataId=parseInt(thisLi.getAttribute("data-id"),10);DB.get(dataId,switchLi,[thisLi])}}function switchLi(data,thisLi){thisLi.finished=!data.finished;if(thisLi.finished){thisLi.classList.add("checked")}else{thisLi.classList.remove("checked")}data.finished=thisLi.finished;DB.update(data)}function handleXClickDelagation(e){var dataId;if(e.target.className==="close"){dataId=parseInt(e.target.getAttribute("data-x"),10);deleteOneData(dataId)}}function deleteOneData(dataId){DB.delete(dataId);showData()}function showWhetherDone(whether){var key="finished";resetNodes();DB.getWhether(whether,key,refreshNodes);console.log("显示数据完毕")}function showDataDone(){showWhetherDone(true)}function showDataTodo(){showWhetherDone(false)}function deleteAllData(){resetNodes();DB.deleteAll()}})()},{"indexeddb-crud":1}]},{},[2]);