!function e(t,n,r){function o(u,i){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!i&&c)return c(u,!0);if(a)return a(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var d=n[u]={exports:{}};t[u][0].call(d.exports,function(e){var n=t[u][1][e];return o(n||e)},d,d.exports,e,t,n,r)}return n[u].exports}for(var a="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){"use strict";!function(){function t(){for(var e=document.querySelector("#myUl");e.hasChildNodes();)e.removeChild(e.firstChild)}function n(){t(),D.retrieveAllDataFromDB(r)}function r(e){var t,n=document.createDocumentFragment(),r=e.length;for(t=0;t<r;t++)n.insertBefore(o(e[t]),n.firstChild);document.querySelector("#myUl").appendChild(n),console.log("刷新，并展示DOM完毕")}function o(e){var t,n,r=document.createTextNode(e.userDate+": "),o=document.createElement("span"),a=document.createTextNode(" "+e.userEvent),u=document.createElement("li");return o.appendChild(a),u.appendChild(r),u.appendChild(o),e.finished&&u.classList.add("checked"),t=document.createElement("span"),n=document.createTextNode("×"),t.className="close",t.appendChild(n),t.setAttribute("data-x",e.id),u.appendChild(t),u.getAttribute("data-index")||u.setAttribute("data-index",e.id),u}function a(){var e,t,n=document.querySelector("#myInput"),r=n.value,a=u("yyyy年MM月dd日 hh:mm"),i=document.querySelector("#myUl");return D.userId++,""===r?(alert("请亲传入数据后重新提交~"),!1):(e={id:D.userId,userEvent:r,finished:!1,userDate:a},(t=o(e)).setAttribute("data-index",e.id),i.insertBefore(t,i.firstChild),n.value="",D.createOneDataToDB(e),0)}function u(e){var t=new Date,n=e,r={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes()};for(var o in r)if(new RegExp("("+o+")").test(n))if("y+"===o)n=n.replace(RegExp.$1,(""+r[o]).substr(4-RegExp.$1.length));else if("S+"===o){var a=RegExp.$1.length;a=1===a?3:a,n=n.replace(RegExp.$1,("00"+r[o]).substr((""+r[o]).length-1,a))}else n=n.replace(RegExp.$1,1===RegExp.$1.length?r[o]:("00"+r[o]).substr((""+r[o]).length));return n}function i(e){13===e.keyCode&&a()}function c(e){var t=e.target;if(t.getAttribute("data-index")){var n=parseInt(t.getAttribute("data-index"),10);D.retrieveOneDataFromDB(n,s,t)}}function s(e,t){t.finished=!e.finished,t.finished?t.classList.add("checked"):t.classList.remove("checked"),e.finished=t.finished,D.updateDateInDB(e)}function d(e){"close"===e.target.className&&l(parseInt(e.target.getAttribute("data-x"),10))}function l(e){D.deleteOneDataInDB(e),n()}function f(e){t(),D.retrieveDataWhetherDoneFromDB(e,r),console.log("显示数据完毕")}function v(){f(!0)}function g(){f(!1)}function m(){t(),D.deleteAllDataInDB()}var D=e("./myIndexedDB");D.init(function(){n();var e=document.querySelector("#myUl");e.addEventListener("click",c,!1),e.addEventListener("click",d,!1),document.getElementById("add").addEventListener("click",a,!1),document.addEventListener("keydown",i,!0),document.getElementById("done").addEventListener("click",v,!1),document.getElementById("todo").addEventListener("click",g,!1),document.getElementById("all").addEventListener("click",n,!1),document.getElementById("delete").addEventListener("click",m,!1)})}()},{"./myIndexedDB":2}],2:[function(e,t,n){"use strict";var r=function(){function e(e,n){var o=indexedDB.open(n.dbname,n.dbVersion);o.onerror=function(){console.log("indexDB加载失败")},o.onsuccess=function(n){r.db=n.target.result,r.userId=t(),e()},o.onupgradeneeded=function(e){if(r.db=e.target.result,!r.db.objectStoreNames.contains("user"))var t=r.db.createObjectStore("user",{keyPath:"id",autoIncrement:!0});t.add({id:0,userEvent:0,finished:!0,date:0})}}function t(){var e=r.db.transaction(["user"],"readwrite").objectStore("user"),t=IDBKeyRange.lowerBound(0);e.openCursor(t,"next").onsuccess=function(e){var t=e.target.result;t?(t.continue(),r.userId=t.value.id):console.log("现在的id为:"+r.userId)}}return{init:function(t){return window.indexedDB?(e(t,{dbname:"justToDo",dbVersion:"1"}),0):(window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available."),0)},createOneDataToDB:function(e){var t=r.db.transaction(["user"],"readwrite").objectStore("user").add(e);t.onerror=function(){console.log("添加到数据库失败")},t.onsuccess=function(){console.log("添加到数据库成功"),console.log("您添加的数据为："+e.userDate+":  "+e.userEvent)}},retrieveOneDataFromDB:function(e,t,n){var o=r.db.transaction(["user"]).objectStore("user").get(e);o.onerror=function(){console.log("查找数据失败")},o.onsuccess=function(){console.log("查找数据成功"),t(o.result,n)}},retrieveDataWhetherDoneFromDB:function(e,t){var n=[],o=r.db.transaction(["user"],"readwrite").objectStore("user"),a=IDBKeyRange.lowerBound(0,!0);o.openCursor(a,"next").onsuccess=function(r){var o=r.target.result;o?(e?o.value.finished&&n.push(o.value):e||o.value.finished||n.push(o.value),o.continue()):t(n)}},retrieveAllDataFromDB:function(e){var t=r.db.transaction(["user"],"readwrite").objectStore("user"),n=IDBKeyRange.lowerBound(0,!0),o=[];t.openCursor(n,"next").onsuccess=function(t){var n=t.target.result;n?(o.push(n.value),n.continue()):e(o)}},updateDateInDB:function(e){var t;t=r.db.transaction(["user"],"readwrite").objectStore("user"),console.log(e);var n=t.put(e);n.onerror=function(){console.log("修改数据失败")},n.onsuccess=function(){console.log("修改数据成功")}},deleteOneDataInDB:function(e){var t=r.db.transaction(["user"],"readwrite").objectStore("user").delete(e);t.onerror=function(){console.log("删除"+e+"到数据库失败")},t.onsuccess=function(){console.log("删除"+e+"到数据库成功")}},deleteAllDataInDB:function(){var e=r.db.transaction(["user"],"readwrite").objectStore("user"),t=IDBKeyRange.lowerBound(0,!0);e.openCursor(t,"next").onsuccess=function(e){var t,n=e.target.result;n&&((t=n.delete()).onsuccess=function(){console.log("删除数据成功")},t.onerror=function(){console.log("删除全部数据失败")},n.continue())}}}}();t.exports=r},{}]},{},[1]);